<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posting - HMPS Informatika</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
</head>

<body class="article-page">

    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html"><i class="fas fa-arrow-left me-2"></i> Kembali ke Beranda</a>
        </div>
    </nav>

    <div class="container mb-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="content">
                    <div id="post-loading" class="text-muted">Memuatâ€¦</div>

                    <div id="post" style="display:none;">
                        <h1 id="post-title" class="fw-bold mb-3"></h1>
                        <p class="text-muted mb-4">
                            <i class="far fa-calendar-alt me-2"></i>
                            <span id="post-date"></span>
                        </p>
                        <img id="post-image" class="article-img" alt="" style="display:none;" />
                        <div id="post-body" class="article-body"></div>
                    </div>

                    <div id="post-error" class="text-danger" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        function getQueryParam(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }

        function formatDate(yyyyMmDd) {
            const d = new Date(yyyyMmDd);
            if (Number.isNaN(d.getTime())) return yyyyMmDd || "";
            return d.toLocaleDateString("id-ID", { day: "2-digit", month: "long", year: "numeric" });
        }

        async function loadPost() {
            const id = getQueryParam("id");
            const loading = document.getElementById("post-loading");
            const postEl = document.getElementById("post");
            const errEl = document.getElementById("post-error");

            if (!id) {
                loading.style.display = "none";
                errEl.style.display = "block";
                errEl.textContent = "Posting tidak ditemukan.";
                return;
            }

            try {
                const res = await fetch("data/posts.json", { cache: "no-store" });
                if (!res.ok) throw new Error("Gagal memuat data posting.");
                const data = await res.json();
                const posts = Array.isArray(data?.posts) ? data.posts : [];
                const post = posts.find(p => p?.id === id);

                if (!post || post.published !== true) {
                    throw new Error("Posting tidak ditemukan.");
                }

                if (post.url) {
                    window.location.replace(post.url);
                    return;
                }

                document.title = (post.title || "Posting") + " - HMPS Informatika";
                document.getElementById("post-title").textContent = post.title || "";
                document.getElementById("post-date").textContent = formatDate(post.date);

                const img = document.getElementById("post-image");
                if (post.image) {
                    img.src = post.image;
                    img.alt = post.title || "";
                    img.style.display = "block";
                }

                const body = document.getElementById("post-body");
                const md = post.content || "";
                body.innerHTML = md ? marked.parse(md) : "<p class=\"text-muted\">Konten belum tersedia.</p>";

                loading.style.display = "none";
                postEl.style.display = "block";
            } catch (e) {
                loading.style.display = "none";
                errEl.style.display = "block";
                errEl.textContent = e?.message || "Terjadi kesalahan.";
            }
        }

        loadPost();
    </script>
</body>

</html>
